<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0">
    
    <title>Ø¨Ø±Ù…Ø¬ Ù…Ø¹ Ø¹Ù„ÙŠ | ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</title>
    <meta name="description" content="Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„Ùƒ Ù„Ù„Ø¹Ø¨ ÙˆÙƒØ³Ø¨ Ø§Ù„Ù†Ù‚Ø§Ø· ÙˆØ§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙƒØ§ÙØ¢Øª!">
    <link rel="canonical" href="https://programmali.github.io/programmali/login.html">
    <link rel="icon" type="image/jpeg" href="https://i.imgur.com/1Hu1phq.jpeg">
    
    <!-- Google Sign-In -->
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color: #2c1810;
            --secondary-color: #5a4035;
            --accent-color: #8b6f5a;
            --light-bg: #f5e6d3;
            --hover-color: #d4c4b0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 50%, var(--accent-color) 100%);
            background-attachment: fixed;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .login-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: clamp(30px, 6vw, 50px);
            max-width: 450px;
            width: 100%;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            position: relative;
        }

        .language-switcher-top {
            position: absolute;
            top: 20px;
            right: 20px;
            background: var(--light-bg);
            color: var(--primary-color);
            border: none;
            padding: 8px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            font-size: 14px;
            transition: all 0.3s ease;
            z-index: 10;
        }

        .language-switcher-top:hover {
            background: var(--hover-color);
            transform: scale(1.05);
        }

        .logo {
            width: 100px;
            height: 100px;
            margin: 0 auto 20px;
            border-radius: 50%;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .logo img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .login-title {
            font-size: clamp(24px, 5vw, 32px);
            color: var(--primary-color);
            text-align: center;
            margin-bottom: 10px;
            font-weight: bold;
        }

        .login-subtitle {
            font-size: clamp(14px, 2.5vw, 16px);
            color: var(--accent-color);
            text-align: center;
            margin-bottom: 30px;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
        }

        .tab {
            flex: 1;
            padding: 12px;
            background: var(--light-bg);
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
            font-size: 16px;
            color: var(--primary-color);
            transition: all 0.3s ease;
        }

        .tab.active {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
        }

        .form-section {
            display: none;
        }

        .form-section.active {
            display: block;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            font-weight: bold;
            color: var(--primary-color);
            margin-bottom: 8px;
            font-size: 14px;
        }

        .form-input {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--hover-color);
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: 0 0 0 3px rgba(139, 111, 90, 0.1);
        }

        .submit-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.3);
        }

        .divider {
            text-align: center;
            margin: 30px 0;
            position: relative;
        }

        .divider::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 1px;
            background: var(--hover-color);
        }

        .divider span {
            background: white;
            padding: 0 15px;
            position: relative;
            color: var(--accent-color);
            font-weight: bold;
        }

        /* Google Sign-In Button Container */
        .google-signin-container {
            display: flex;
            justify-content: center;
            margin: 20px 0;
            min-height: 44px;
        }

        #googleButton {
            display: flex;
            justify-content: center;
            width: 100%;
        }

        .guest-btn {
            width: 100%;
            padding: 15px;
            background: var(--light-bg);
            color: var(--primary-color);
            border: 2px solid var(--accent-color);
            border-radius: 10px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 15px;
        }

        .guest-btn:hover {
            background: var(--hover-color);
            transform: translateY(-2px);
        }

        .message {
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
            font-weight: bold;
            display: none;
        }

        .message.show {
            display: block;
        }

        .message.success {
            background: #d1fae5;
            color: #065f46;
        }

        .message.error {
            background: #fee2e2;
            color: #991b1b;
        }

        .back-home {
            text-align: center;
            margin-top: 20px;
        }

        .back-home a {
            color: var(--accent-color);
            text-decoration: none;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .back-home a:hover {
            color: var(--primary-color);
        }

        .note {
            background: #d1fae5;
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
            text-align: center;
            border: 2px solid #10b981;
        }

        .note-title {
            font-weight: bold;
            color: #065f46;
            margin-bottom: 5px;
        }

        .note-text {
            color: #047857;
            font-size: 14px;
        }

        @media (max-width: 480px) {
            .login-container {
                padding: 25px;
            }

            .tab {
                font-size: 14px;
                padding: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="login-container">
        <button class="language-switcher-top" onclick="toggleLanguage()" id="langBtn">English</button>
        
        <div class="logo">
            <img src="https://i.imgur.com/1Hu1phq.jpeg" alt="Logo">
        </div>

        <h1 class="login-title" data-ar="Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ!" data-en="Welcome!">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ!</h1>
        <p class="login-subtitle" data-ar="Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„Ùƒ Ù„Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨ ÙˆÙƒØ³Ø¨ Ø§Ù„Ù†Ù‚Ø§Ø·" data-en="Login to start playing and earn points">Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„Ùƒ Ù„Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨ ÙˆÙƒØ³Ø¨ Ø§Ù„Ù†Ù‚Ø§Ø·</p>

        <div id="message" class="message"></div>

        <div class="tabs">
            <button class="tab active" onclick="switchTab('login')" data-ar="ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„" data-en="Login">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
            <button class="tab" onclick="switchTab('register')" data-ar="Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨" data-en="Register">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨</button>
        </div>

        <!-- Login Form -->
        <div id="loginForm" class="form-section active">
            <form onsubmit="handleLogin(event)">
                <div class="form-group">
                    <label class="form-label" data-ar="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£Ùˆ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ" data-en="Username or Email">Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£Ùˆ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
                    <input type="text" id="loginUsername" class="form-input" required>
                </div>

                <div class="form-group">
                    <label class="form-label" data-ar="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" data-en="Password">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
                    <input type="password" id="loginPassword" class="form-input" required>
                </div>

                <button type="submit" class="submit-btn" data-ar="ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„" data-en="Login">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
            </form>
        </div>

        <!-- Register Form -->
        <div id="registerForm" class="form-section">
            <form onsubmit="handleRegister(event)">
                <div class="form-group">
                    <label class="form-label" data-ar="Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„" data-en="Full Name">Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„</label>
                    <input type="text" id="registerName" class="form-input" required>
                </div>

                <div class="form-group">
                    <label class="form-label" data-ar="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…" data-en="Username">Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</label>
                    <input type="text" id="registerUsername" class="form-input" required>
                </div>

                <div class="form-group">
                    <label class="form-label" data-ar="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ" data-en="Email">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
                    <input type="email" id="registerEmail" class="form-input" required>
                </div>

                <div class="form-group">
                    <label class="form-label" data-ar="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" data-en="Password">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
                    <input type="password" id="registerPassword" class="form-input" required minlength="6">
                </div>

                <button type="submit" class="submit-btn" data-ar="Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨" data-en="Register">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨</button>
            </form>
        </div>

        <div class="divider">
            <span data-ar="Ø£Ùˆ" data-en="OR">Ø£Ùˆ</span>
        </div>

        <!-- Google Sign-In Button -->
        <div class="google-signin-container">
            <div id="googleButton"></div>
        </div>

        <button class="guest-btn" onclick="guestLogin()" data-ar="ğŸ® Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙƒØ²Ø§Ø¦Ø±" data-en="ğŸ® Continue as Guest">ğŸ® Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙƒØ²Ø§Ø¦Ø±</button>

        <div class="note">
            <div class="note-title" data-ar="âœ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù…ÙØ¹Ù‘Ù„!" data-en="âœ… Google Sign-In Enabled!">âœ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù…ÙØ¹Ù‘Ù„!</div>
            <div class="note-text" data-ar="ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¢Ù† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¹Ø¨Ø± Google Ù…Ø¨Ø§Ø´Ø±Ø©!" data-en="You can now sign in with Google directly!">ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¢Ù† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¹Ø¨Ø± Google Ù…Ø¨Ø§Ø´Ø±Ø©!</div>
        </div>

        <div class="back-home">
            <a href="index.html" data-ar="â† Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©" data-en="â† Back to Home">â† Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
        </div>
    </div>

    <script>
        const STORAGE_KEY = 'programmali_user_data';
        const USERS_KEY = 'programmali_users';
        let currentLang = 'ar';

        // Language Toggle
        function toggleLanguage() {
            currentLang = currentLang === 'ar' ? 'en' : 'ar';
            const langBtn = document.getElementById('langBtn');
            
            langBtn.textContent = currentLang === 'ar' ? 'English' : 'Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©';
            
            document.querySelectorAll('[data-ar][data-en]').forEach(element => {
                element.textContent = element.getAttribute(`data-${currentLang}`);
            });
            
            document.documentElement.setAttribute('lang', currentLang);
            document.documentElement.setAttribute('dir', currentLang === 'ar' ? 'rtl' : 'ltr');
            
            localStorage.setItem('preferredLanguage', currentLang);
        }

        // Load saved language
        window.addEventListener('DOMContentLoaded', () => {
            const savedLang = localStorage.getItem('preferredLanguage');
            if (savedLang && savedLang !== 'ar') {
                toggleLanguage();
            }
        });

        // ========================================
        // Google Sign-In - Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©! âœ…
        // ========================================
        
        window.onload = function() {
            // Ø§Ù…Ø³Ø­ Ø£ÙŠ Ø¨ÙŠØ§Ù†Ø§Øª Ø²Ø§Ø¦Ø± Ù‚Ø¯ÙŠÙ…Ø©
            const userData = localStorage.getItem(STORAGE_KEY);
            if (userData) {
                const user = JSON.parse(userData);
                if (!user.isGoogleUser && !user.username) {
                    // Ù‡Ø°Ø§ Ø²Ø§Ø¦Ø± - Ø§Ù…Ø³Ø­Ù‡
                    localStorage.removeItem(STORAGE_KEY);
                }
            }
            
            // ØªÙ‡ÙŠØ¦Ø© Google Sign-In Ø¨Ø·Ø±ÙŠÙ‚Ø© ØµØ­ÙŠØ­Ø©
            google.accounts.id.initialize({
                client_id: '736529467752-jl6rp0j3ab1jn3rda5v1n6jm3esfjdoe.apps.googleusercontent.com',
                callback: handleGoogleResponse,
                auto_select: false, // Ù„Ø§ ØªØ®ØªØ§Ø± ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
                cancel_on_tap_outside: false // Ù„Ø§ ØªÙ„ØºÙŠ Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø®Ø§Ø±Ø¬ Ø§Ù„Ù†Ø§ÙØ°Ø©
            });
            
            // Ø¹Ø±Ø¶ Ø§Ù„Ø²Ø± - Ù‡Ø°Ø§ ÙŠØ¹Ù…Ù„ Ø¯Ø§Ø¦Ù…Ø§Ù‹! âœ…
            google.accounts.id.renderButton(
                document.getElementById('googleButton'),
                {
                    theme: 'outline',
                    size: 'large',
                    width: 350,
                    text: 'signin_with',
                    shape: 'rectangular',
                    logo_alignment: 'left'
                }
            );
        }

        // Handle Google response
        function handleGoogleResponse(response) {
            try {
                // ÙÙƒ ØªØ´ÙÙŠØ± JWT token Ù…Ù† Google
                const userInfo = parseJwt(response.credential);
                
                const googleUser = {
                    name: userInfo.name,
                    email: userInfo.email,
                    username: 'google_' + userInfo.sub,
                    googleId: userInfo.sub,
                    picture: userInfo.picture,
                    points: 0,
                    highScore: 0,
                    gamesPlayed: 0,
                    rewards: [],
                    joinDate: new Date().toISOString(),
                    isGoogleUser: true
                };
                
                // Check if user exists
                const users = getUsers();
                const existingUser = users.find(u => u.googleId === googleUser.googleId);
                
                if (existingUser) {
                    // Login existing user
                    localStorage.setItem(STORAGE_KEY, JSON.stringify(existingUser));
                } else {
                    // Create new user
                    users.push(googleUser);
                    saveUsers(users);
                    localStorage.setItem(STORAGE_KEY, JSON.stringify(googleUser));
                }
                
                showMessage(
                    'ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¹Ø¨Ø± Google Ø¨Ù†Ø¬Ø§Ø­! ğŸ‰',
                    'Google Sign-In successful! ğŸ‰',
                    'success'
                );
                
                setTimeout(() => {
                    window.location.href = 'game.html';
                }, 1500);
            } catch (error) {
                console.error('Google Sign-In Error:', error);
                showMessage(
                    'Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„. Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰!',
                    'Sign-in error. Please try again!',
                    'error'
                );
            }
        }

        // Parse JWT token
        function parseJwt(token) {
            const base64Url = token.split('.')[1];
            const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
            const jsonPayload = decodeURIComponent(atob(base64).split('').map(c => {
                return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
            }).join(''));
            return JSON.parse(jsonPayload);
        }

        // Switch between tabs
        function switchTab(tab) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.form-section').forEach(f => f.classList.remove('active'));
            
            if (tab === 'login') {
                document.querySelectorAll('.tab')[0].classList.add('active');
                document.getElementById('loginForm').classList.add('active');
            } else {
                document.querySelectorAll('.tab')[1].classList.add('active');
                document.getElementById('registerForm').classList.add('active');
            }
            
            hideMessage();
        }

        // Show message
        function showMessage(textAr, textEn, type) {
            const msg = document.getElementById('message');
            msg.textContent = currentLang === 'ar' ? textAr : textEn;
            msg.className = 'message ' + type + ' show';
        }

        function hideMessage() {
            document.getElementById('message').className = 'message';
        }

        // Get all users
        function getUsers() {
            const users = localStorage.getItem(USERS_KEY);
            return users ? JSON.parse(users) : [];
        }

        // Save users
        function saveUsers(users) {
            localStorage.setItem(USERS_KEY, JSON.stringify(users));
        }

        // Handle Login
        function handleLogin(event) {
            event.preventDefault();
            
            // Ø§Ù…Ø³Ø­ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø²Ø§Ø¦Ø± Ø£ÙˆÙ„Ø§Ù‹
            localStorage.removeItem(STORAGE_KEY);
            
            const username = document.getElementById('loginUsername').value.trim();
            const password = document.getElementById('loginPassword').value;
            
            const users = getUsers();
            const user = users.find(u => 
                (u.username === username || u.email === username) && u.password === password
            );
            
            if (user) {
                const userData = {
                    name: user.name,
                    username: user.username,
                    email: user.email,
                    points: user.points || 0,
                    highScore: user.highScore || 0,
                    gamesPlayed: user.gamesPlayed || 0,
                    rewards: user.rewards || [],
                    joinDate: user.joinDate
                };
                
                localStorage.setItem(STORAGE_KEY, JSON.stringify(userData));
                
                showMessage(
                    'ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­! Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­ÙˆÙŠÙ„...',
                    'Login successful! Redirecting...',
                    'success'
                );
                
                setTimeout(() => {
                    window.location.href = 'game.html';
                }, 1500);
            } else {
                showMessage(
                    'Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£Ùˆ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©!',
                    'Invalid username or password!',
                    'error'
                );
            }
        }

        // Handle Register
        function handleRegister(event) {
            event.preventDefault();
            
            // Ø§Ù…Ø³Ø­ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø²Ø§Ø¦Ø± Ø£ÙˆÙ„Ø§Ù‹
            localStorage.removeItem(STORAGE_KEY);
            
            const name = document.getElementById('registerName').value.trim();
            const username = document.getElementById('registerUsername').value.trim();
            const email = document.getElementById('registerEmail').value.trim();
            const password = document.getElementById('registerPassword').value;
            
            const users = getUsers();
            
            // Check if username or email already exists
            if (users.find(u => u.username === username)) {
                showMessage(
                    'Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…ÙˆØ¬ÙˆØ¯ Ø¨Ø§Ù„ÙØ¹Ù„!',
                    'Username already exists!',
                    'error'
                );
                return;
            }
            
            if (users.find(u => u.email === email)) {
                showMessage(
                    'Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ù…Ø³Ø¬Ù„ Ø¨Ø§Ù„ÙØ¹Ù„!',
                    'Email already registered!',
                    'error'
                );
                return;
            }
            
            const newUser = {
                name,
                username,
                email,
                password,
                points: 0,
                highScore: 0,
                gamesPlayed: 0,
                rewards: [],
                joinDate: new Date().toISOString(),
                isGoogleUser: false
            };
            
            users.push(newUser);
            saveUsers(users);
            
            const userData = {
                name: newUser.name,
                username: newUser.username,
                email: newUser.email,
                points: newUser.points,
                highScore: newUser.highScore,
                gamesPlayed: newUser.gamesPlayed,
                rewards: newUser.rewards,
                joinDate: newUser.joinDate
            };
            
            localStorage.setItem(STORAGE_KEY, JSON.stringify(userData));
            
            showMessage(
                'ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø¨Ù†Ø¬Ø§Ø­! Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­ÙˆÙŠÙ„...',
                'Account created successfully! Redirecting...',
                'success'
            );
            
            setTimeout(() => {
                window.location.href = 'game.html';
            }, 1500);
        }

        // Guest Login
        function guestLogin() {
            // Ø§Ù…Ø³Ø­ Ø£ÙŠ Ø¨ÙŠØ§Ù†Ø§Øª Ù‚Ø¯ÙŠÙ…Ø©
            localStorage.removeItem(STORAGE_KEY);
            
            const guestUser = {
                name: currentLang === 'ar' ? 'Ø²Ø§Ø¦Ø±' : 'Guest',
                points: 0,
                highScore: 0,
                gamesPlayed: 0,
                rewards: [],
                joinDate: new Date().toISOString(),
                isGuest: true
            };
            
            localStorage.setItem(STORAGE_KEY, JSON.stringify(guestUser));
            
            showMessage(
                'Ù…Ø±Ø­Ø¨Ø§Ù‹! Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­ÙˆÙŠÙ„...',
                'Welcome! Redirecting...',
                'success'
            );
            
            setTimeout(() => {
                window.location.href = 'game.html';
            }, 1000);
        }
    </script>
</body>
</html>
